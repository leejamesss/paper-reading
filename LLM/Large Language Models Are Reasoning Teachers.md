代码链接：https://github.com/itsnamgyu/reasoning-teacher

![image](https://github.com/leejamesss/paper-reading/assets/117844938/ca3136fc-924e-4b4f-bdef-f0a6de2e522f)
## Fine-tune-CoT 的蒸馏步骤
- 一个非常大的教师模型被提示通过生成多步推理解释(绿色)来解决复杂的问题(黄色)
- 根据最终预测的正确性(红色)对生成的补全进行筛选。问题、基本原理和答案用于组成由提示和多步骤完成组成的推理示例
- 精心策划的推理样本用于微调一个小的、轻量级的学生模型
- 同时基于 LM 的教师模型支持了多样化的推理——为每个原始样本生成多个不同的基本原理，以丰富微调数据。这提高了学生模型的性能，并且不需要人工注释


## Dataset/Algorithm/Model/Experiment Detail
### 实现方式

#### Step 1. Reasoning generation
- 首先利用一个大型教师模型为给定的任务生成CoT推理解释
- 考虑一个标准样本Si，由一个问题qi和它的真实答案ai组成。使用 Zero-shot-CoT 模型，提示教师模型生成一个推理解释 ri 来解决 qi，生成的最终答案为 ai
- 生成的文本序列，包括提示符和生成，采用以下形式： “Q: A: Let’s think step by step. <ˆri> Therefore, the answer is <ˆai>”

#### Step 2. Curation
为了准备微调样本，过滤生成的样本并将它们重新格式化为提示补全对
对于过滤，简单地将教师模型的最终预测 ai与 ground-truth 答案 ai 进行比较，挑选预测与 gt 一致的样本
将(Si, ri​ , ai) 重新打包成一个推理样本S’i = (pi, ci)，一个提示补全对
  
#### Step 3. Fine-tune
使用广泛可访问的 OpenAI API 在组装的推理样本上对一个小型预训练的学生模型进行微调。使用与预训练期间相同的训练目标，即 autoregressive language modeling objective 或next-token prediction 

### Diverse reasoning
- 为了使微调- cot的样本效率最大化，为每个训练样本生成多个推理解释，从而增加微调数据
- 对于给定的样本 Si，采用随机采样策略，即大 T 的温度采样，而不是采用贪婪解码的 Zero-shot-CoT 来获得单个解释-答案对 (ei, ai)，以获得 D 个不同的样本对


### 实验结果
#### 实验配置
##### 模型列表，学生模型比非常大的教师模型小25 - 500倍
![image](https://github.com/leejamesss/paper-reading/assets/117844938/1384834a-42a1-47ab-8fa9-fcaef9c502fe)

##### 用于对比的 baseline 模型
![image](https://github.com/leejamesss/paper-reading/assets/117844938/59eef6e7-885c-4865-b265-967d979dd1b0)

- Zero-shot-CoT： task-agnostic prompting baseline
- finetuning：使用原始训练样本进行 finetune
- Fine-tune-CoT：本文方法

##### 实验结果
12 个数据集上的对比结果，“Random” 指的是在多项选择题的任务中，根据选项的数量随机猜测的表现，即只能以正确格式输出随机答案的模型的性能。
![image](https://github.com/leejamesss/paper-reading/assets/117844938/79b66085-2e59-4f25-9c61-cfd095e27c24)

- Fine-tune-CoT 性能超过 Zero-shot-CoT
- 一些数据集上小模型效果超过了大模型：Shuffled Objects and Coin Flip
- Fine-tune vs Fine-tune-CoT： Date Understanding and Shuffle Objects 数据上 Fine-tune-CoT 比 Fine-tune 精度明显高（Fine-tune 精度与 Random 差不多），某些数据集上 Fine-tune 精度也会比 Fine-tune-CoT 高，不过 Fine-tune-CoT 性能随着模型大小的增大表现出更加可靠的性能，并在需要多个步骤的任务中显示出明显的优势





![image](https://github.com/leejamesss/paper-reading/assets/117844938/13b98985-f2a8-4930-b9db-32847e9bcaea)
![image](https://github.com/leejamesss/paper-reading/assets/117844938/9a701b62-fcc7-4e24-84df-0de10d64275d)
![image](https://github.com/leejamesss/paper-reading/assets/117844938/37b6bdf4-a64f-42cd-95aa-f1fdeebd42da)


# 文章概要
- **利用大型语言模型作为推理教师**：这篇文章提出了一种方法，可以用大型语言模型生成多步推理样本，然后用这些样本来微调小型模型，从而提高小型模型的复杂推理能力。
- **Fine-tune-CoT的优点**：这种方法有以下几个优点：(1) 它可以解决大型语言模型在复杂任务上的挑战；(2) 它可以降低小型模型的规模需求和部署成本，同时保持高性能和可解释性；(3) 它可以利用大型语言模型的随机生成能力，产生多样化的推理样本来丰富训练数据，从而显著提高学习效果；(4) 它可以适用于任何复杂任务，而不需要任务特定的工程或人工注释。
- **多样化推理的作用**：这篇文章还提出了一种扩展方法，即利用大型语言模型生成多个不同的推理解决方案来增加训练数据的多样性。这种方法可以显著提升小型模型的性能，甚至超过大型教师模型在一些任务上的表现。
- **实验结果和分析**：这篇文章在12个涉及四类复杂推理的数据集上评估了这种方法，并使用了多种公开可用的模型。结果表明，Fine-tune-CoT可以在小型模型中激发出显著的推理性能，远超过基于提示的基线方法，甚至在一些任务上超过教师模型。此外，文章还进行了消融实验和样本研究，以了解学生模型推理能力的产生。
- **Fine-tune-CoT的局限性**：这篇文章讨论了Fine-tune-CoT方法的一些局限性，例如：(1) 它只能利用高成本的大型语言模型作为教师；(2) 它只能适用于需要多步推理的任务，而不能处理需要常识或逻辑推理的任务；(3) 它没有考虑教师模型生成的推理样本的质量和正确性，而只是根据最终答案进行过滤；(4) 它没有对学生模型的推理能力进行定量或定性的评估。
- **Fine-tune-CoT与知识蒸馏的联系**：这篇文章指出了Fine-tune-CoT与经典的知识蒸馏方法之间的一些联系，例如：(1) 它可以利用教师模型输出的中间推理来传递“暗知识”；(2) 它存在数量-质量的权衡，即使用更多但不完全正确的推理样本可能比使用更少但完全正确的推理样本更有益；(3) 它也发现了更准确的教师模型会导致更准确的学生模型，这与知识蒸馏中并不总是如此。
- **Fine-tune-CoT的道德问题**：这篇文章讨论了Fine-tune-CoT在偏见、毒性和安全方面的一些挑战和机会，例如：(1) 它可能会从大型语言模型中继承一些存在于训练数据中的偏见或毒性；(2) 它可以通过过滤或优化教师模型生成的推理样本来减少学生模型中的偏见或毒性；(3) 它可能会被恶意使用者利用来利用复杂推理进行恶意目的，并且可以使用小型模型进行大规模部署。

- **数学和常识推理的例子**：这篇文章给出了一些涉及数学和常识推理的问题，以及教师模型和学生模型的输出。这些例子展示了Fine-tune-CoT方法在这些任务上的优势和局限性。
- **Fine-tune-CoT的未来工作**：这篇文章提出了一些可能的未来工作，例如：(1) 探索不同的教师模型和学生模型的组合；(2) 改进教师模型生成的推理样本的质量和多样性；(3) 评估学生模型的推理能力和可解释性；(4) 应用Fine-tune-CoT方法到其他领域和任务。
- **Fine-tune-CoT的结论**：这篇文章总结了Fine-tune-CoT方法的主要贡献和创新，例如：(1) 利用大型语言模型作为推理教师来提高小型模型的复杂推理能力；(2) 利用大型语言模型生成多样化的推理样本来丰富训练数据；(3) 适用于任何复杂任务，而不需要任务特定的工程或人工注释。




# 这篇论文的主要贡献是什么？


- 提出了一种利用大型语言模型作为推理教师的方法，可以在较小的模型上实现复杂的推理能力，大大降低了模型大小的需求。
- 提出了一种多样化推理的扩展方法，可以利用教师模型生成多个不同的推理解释来丰富微调数据，从而显著提高学生模型的性能。
- 在12个涉及四类复杂推理的任务上评估了该方法，发现该方法可以使较小的模型远远超过基于提示的基线，甚至在某些任务上超过教师模型。
- 进行了深入的样本研究和分析，揭示了微调复杂推理任务的一些细节，并探讨了推理能力在较小模型中的出现。


# 这个贡献重要吗？为什么？

- 它可以解决大型语言模型在复杂任务上的挑战，例如数学或常识推理。
- 它可以降低小型模型的规模需求和部署成本，同时保持高性能和可解释性。
- 它可以利用大型语言模型的随机生成能力，产生多样化的推理样本来丰富训练数据，从而显著提高学习效果。
- 它可以适用于任何复杂任务，而不需要任务特定的工程或人工注释 。

# 这篇论文的局限是什么？
- 它只能利用大型语言模型作为推理教师，而这些模型的训练和部署成本很高，而且可能存在偏见和毒性的问题。
- 它只能适用于需要多步推理的复杂任务，而不能处理需要常识、背景知识或逻辑推理的任务。
- 它没有考虑教师模型生成的推理样本的质量和正确性，而只是根据最终答案进行过滤。这可能导致一些错误或不完整的推理被用于微调学生模型。
- 它没有对学生模型的推理能力进行定量或定性的评估，而只是使用准确率作为评价指标。这可能忽略了学生模型的推理过程和解释性。


  
# 这篇论文的研究假设是什么？这些假设是否合理、局限或过于简化？

这篇论文的研究假设是：

- 大型语言模型可以通过链式思维（CoT）提示来表现出复杂推理能力，即生成一系列中间推理步骤来解决问题 。
- 小型语言模型可以通过在大型语言模型生成的推理样本上进行微调来提高复杂推理能力，从而降低模型规模和部署成本 。
- 大型语言模型可以利用其随机生成能力，为每个问题生成多个不同的推理解决方案，从而增加训练数据的多样性和丰富性，进而提高小型语言模型的性能 。

这些假设有以下几点合理性、局限性或过于简化的地方：

- 合理性：这些假设基于对大型语言模型和小型语言模型的特点和能力的分析，以及对复杂推理任务的需求和挑战的认识。这些假设也得到了实验结果和分析的支持，表明了这种方法在多个复杂推理数据集上的有效性和优势。
- 局限性：这些假设也存在一些局限性，例如：(1) 它们只能利用高成本的大型语言模型作为教师，而这些模型可能存在偏见、毒性和安全方面的问题；(2) 它们只能适用于需要多步推理的任务，而不能处理需要常识、背景知识或逻辑推理的任务；(3) 它们没有考虑教师模型生成的推理样本的质量和正确性，而只是根据最终答案进行过滤；(4) 它们没有对学生模型的推理能力和可解释性进行定量或定性的评估。
- 过于简化：这些假设也可能过于简化了一些复杂推理任务的本质和难度，例如：(1) 它们没有考虑不同任务之间的差异和联系，以及不同领域和场景下的推理需求和规则；(2) 它们没有考虑人类推理过程中的不确定性、多样性和创造性，以及人类与机器之间的交互和协作；(3) 它们没有考虑大型语言模型和小型语言模型之间的内在联系和差异，以及它们在不同层次上的知识表示和传递方式。

# 基于这篇论文的可能应用有哪些？

- **提高小型语言模型的复杂推理能力**：这篇论文提出的Fine-tune-CoT方法可以利用大型语言模型作为推理教师，来教导小型语言模型如何进行多步推理，从而提高小型语言模型在复杂任务上的性能和可解释性。这种方法可以降低小型语言模型的规模需求和部署成本，同时保持高效和通用的推理能力。
- **丰富复杂推理任务的训练数据**：这篇论文提出的多样化推理方法可以利用大型语言模型的随机生成能力，为每个问题生成多个不同的推理解决方案，从而增加训练数据的多样性和丰富性。这种方法可以显著提升小型语言模型的性能，甚至超过大型教师模型在一些任务上的表现。
- **应用到其他领域和任务**：这篇论文展示了Fine-tune-CoT方法在四类复杂推理任务上的有效性，包括算术、其他、符号和常识推理。这些任务涵盖了一些重要的应用场景，例如数学、日期、逻辑、常识等。此外，这种方法也可以适用于任何复杂任务，而不需要任务特定的工程或人工注释。因此，这种方法对于语言模型的推理研究和应用有着广泛的潜力。


# 在该文基础上，有些工作可以继续延伸下去？如何延伸？

- **探索不同的教师模型和学生模型的组合**：这篇文章使用了GPT-3 175B作为教师模型，以及GPT-3、GPT-2、T5和Flan-T5作为学生模型。未来的工作可以尝试使用其他类型和规模的语言模型，例如BERT、XLNet、ELECTRA等，来比较它们在复杂推理任务上的表现和差异。
- **改进教师模型生成的推理样本的质量和多样性**：这篇文章使用了Zero-shot-CoT方法来生成推理样本，但是这种方法可能存在一些局限性，例如：(1) 它依赖于大型语言模型的生成能力，而这些模型可能存在偏见、毒性和安全方面的问题；(2) 它没有考虑教师模型生成的推理样本的质量和正确性，而只是根据最终答案进行过滤；(3) 它没有考虑不同任务之间的差异和联系，以及不同领域和场景下的推理需求和规则。未来的工作可以尝试使用其他的CoT方法，例如Few-shot-CoT、Meta-CoT等，来提高推理样本的质量和多样性。
- **评估学生模型的推理能力和可解释性**：这篇文章使用了准确率作为评价指标，但是这种指标可能忽略了学生模型的推理过程和解释性。未来的工作可以尝试使用其他的评价指标，例如推理步骤的正确性、完整性、一致性等，以及推理解释的可信度、可理解度、可接受度等，来定量或定性地评估学生模型的推理能力和可解释性。
- **应用Fine-tune-CoT方法到其他领域和任务**：这篇文章展示了Fine-tune-CoT方法在四类复杂推理任务上的有效性，包括算术、其他、符号和常识推理。这些任务涵盖了一些重要的应用场景，例如数学、日期、逻辑、常识等。此外，这种方法也可以适用于任何复杂任务，而不需要任务特定的工程或人工注释。未来的工作可以尝试将Fine-tune-CoT方法应用到其他领域和任务，例如自然科学、社会科学、人文科学等，以及涉及常识、背景知识或逻辑推理等更高层次的复杂推理任务。

# 这篇论文中，哪些是你还没明白的地方？

- 我不太清楚这篇论文的数学和符号推理任务的具体内容和难度，以及它们与其他领域和任务的联系。我想知道这些任务是如何设计和选择的，以及它们对于语言模型的推理能力的评估有什么意义。
- 我不太理解这篇论文的多样化推理方法的具体实现和原理，以及它与其他数据增强技术的区别和优势。我想知道这种方法是如何利用大型语言模型的随机生成能力，以及它对于小型模型的性能提升有什么影响因素。
- 我不太了解这篇论文的Fine-tune-CoT方法与经典的知识蒸馏方法之间的联系和差异，以及它们在不同层次上的知识表示和传递方式。我想知道这种方法是如何利用教师模型输出的中间推理来传递“暗知识”，以及它存在什么样的数量-质量的权衡。

# 还有什么其他相关的论文？它们之间有什么关系？
- 知识蒸馏相关论文
- CoT相关论文(Zero-shot CoT、Few-shot CoT、Auto CoT、Fine-Tune CoT)

# 基于这篇论文的思想，若要做一个项目，能否用两句话描述一下这个项目的大致思想？

- 选择一个需要多步推理的复杂任务，例如数学问题求解、常识推理、逻辑推理等。
- 使用一个大型语言模型，例如GPT-3，来生成多个不同的推理解决方案，并用这些方案来微调一个小型语言模型，例如GPT-2，从而提升小型模型的性能和可解释性。



# 疑难解答
##  这篇论文的方法实现多样化推理的步骤如下：

- 首先，使用一个大型的教师模型，通过Zero-shot-CoT的方式，为每个训练样本生成一个推理解释和答案。
- 然后，使用一个随机采样的策略，为每个训练样本生成多个不同的推理解释和答案，从而增加推理路径的多样性。
- 最后，使用这些多样化的推理样本来微调一个较小的学生模型，使其能够在测试时生成复杂的推理解释和答案。

这篇论文认为，多样化推理可以提高学生模型的性能，因为复杂任务可以有多种解决方案和推理过程。通过利用教师模型的生成能力，可以丰富微调数据，增强学生模型的泛化能力和可解释性。



## 如何选择教师模型的大小？

选择教师模型的大小时，有以下几个因素需要考虑：

- 教师模型的推理性能：教师模型的推理性能越高，生成的推理样本越可靠，从而更好地指导小型模型学习推理能力。论文中使用了四种不同版本的GPT-3 175B作为教师模型，并发现学生模型的性能随着教师模型的性能而提高。
- 教师模型的生成多样性：教师模型的生成多样性指的是教师模型能够为同一个问题生成多个不同的推理解决方案。这种多样性可以丰富微调数据，提高学生模型的泛化能力。论文中使用了温度采样的方法来增加教师模型的生成多样性，并发现这种方法可以显著提升学生模型的性能。
- 教师模型的可用性和成本：教师模型的可用性和成本指的是获取和使用教师模型所需的资源和时间。一般来说，越大的教师模型越难以获取和使用，因为它们需要更多的计算资源和费用。论文中使用了OpenAI API提供的公开可用的GPT-3 175B作为教师模型，并分析了不同程度的多样性对开发成本和学生性能的影响。



## 温度采样是什么？

温度采样是一种用于控制生成文本随机性的技术。它的工作原理是根据温度参数调整可能的下一个标记的概率分布。温度参数是一个介于 0 和 1 之间的数值，数值越大，输出的随机性就越大，而数值越小，输出的随机性就越集中和确定。

例如，如果温度参数设置为 0.8 这样的高值，模型生成的文本将更加随机和多样化。另一方面，如果将温度设置为 0.2 这样的低值，模型生成的文本将更加集中和可预测。如果温度设置为 0，模型将使用对数概率自动提高温度，直到达到特定的阈值。

温度采样在使用语言模型生成文本时非常有用，因为它可以让你控制生成文本的创造性和连贯性之间的平衡。



